# this config is heavily inspired from https://github.com/FriendsOfPHP/PHP-CS-Fixer/blob/master/.travis.yml

language: php
sudo: false

env:
    global:
        - DEFAULT_COMPOSER_FLAGS="--no-interaction --no-progress --optimize-autoloader"
        - TASK_TESTS=1
        - TASK_CS=1

matrix:
    fast_finish: true
    include:
        - php: 7.1
          env: DEPLOY=yes TASK_TESTS_COVERAGE=1
        - php: 7.0

cache:
    directories:
        - $HOME/.composer

before_install:
    # turn off XDebug
    - phpenv config-rm xdebug.ini || return 0

    # display tasks configuration for a job
    - set | grep ^TASK | sort

    - php-cs-fixer --version

install:
    - travis_retry composer update $DEFAULT_COMPOSER_FLAGS $COMPOSER_FLAGS
    - composer info -D | sort

script:
    - if [ $TASK_TESTS == 1 ]; then vendor/bin/phpunit --verbose; fi
    - if [ $TASK_CS == 1 ]; then php php-cs-fixer --diff --dry-run -v fix; fi

#before_deploy:
#    # install box2
#    - curl -LSs http://box-project.github.io/box2/installer.php | php
#    - php box.phar --version

#deploy:
#    provider: releases
#    file: build/pimcore.phar
#    skip_cleanup: true
#    on:
#        repo: pimcore/pimcore-cli
#        tags: true
#        condition: $DEPLOY = yes
